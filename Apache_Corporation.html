<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Ticket Form - Apache Corporation</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
        }

        .container, .header-container, table, tr, td, th {
            page-break-inside: avoid;
        }

        .page-break {
            page-break-after: always;
        }

        .header-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            background: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .header-left img {
            max-width: 275px;
        }

        .header-middle input, .header-right input, select {
            margin-bottom: 10px;
            background: #fff;
            border: 1px solid #ced4da;
            padding: 5px;
            text-align: center;
        }

        select {
            appearance: none;
            background: #cfcfc2 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" fill="gray"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"/></svg>') no-repeat right 10px center;
            background-size: 16px;
        }

        table {
            background: #fff;
            width: 100%;
            padding: 20px;
            border-collapse: collapse;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        th {
            background: #f0f0f0;
            font-weight: bold;
        }

        td:first-child {
            width: 50%;
        }

        input.form-control, textarea.form-control {
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
            resize: none;
        }

        #signature-pad {
            touch-action: none;
            border: 1px solid #ced4da;
        }
    </style>
</head>
<body>
    <form id="fieldTicketForm">
        <div class="container mt-5">
            <div class="header-container">
                <div class="header-left">
                    <img src="TAZ-Logo.png" alt="TAZ Well Service, Inc">
                    <h4>TAZ Well Service, Inc</h4>
                    <p>PO Box 41</p>
                    <p>Colorado City, TX 79512</p>
                    <p><strong>BILL TO:</strong></p>
                    <textarea class="form-control" placeholder="Enter billing information" rows="4"></textarea>
                </div>
                <div class="header-middle">
                    <label for="date">Date:</label>
                    <input type="date" id="date" value="2024-09-20">
                    <label for="customer">CUSTOMER NAME:</label>
                    <input type="text" id="customer" class="form-control" value="Apache Corporation" readonly>
                    <label for="wellName">WELL NAME:</label>
                    <input type="text" id="wellName" placeholder="Enter Well Name">
                    <label for="county">COUNTY:</label>
                    <input type="text" id="county" placeholder="Enter County">
                    <label for="state">STATE:</label>
                    <select id="state" class="form-control">
                        <option value="" disabled selected>Select State</option>
                        <option value="NM">New Mexico</option>
                        <option value="OK">Oklahoma</option>
                        <option value="TX">Texas</option>
                    </select>
                </div>
                <div class="header-right">
                    <label for="ticket">Ticket #:</label>
                    <input type="text" id="ticket" placeholder="Enter Ticket #">
                    <label for="rig">RIG #:</label>
                    <select id="rig" class="form-control">
                        <option value="" disabled selected>Select Rig</option>
                        ${[...Array(19)].map((_, i) => `<option value="Rig${i + 3}">Rig ${i + 3}</option>`).join('')}
                    </select>
                    <label for="afe">AFE #:</label>
                    <input type="text" id="afe" placeholder="Enter AFE #">
                    <label for="po">PO #:</label>
                    <input type="text" id="po" placeholder="Enter PO #">
                    <label for="coMan">CO. MAN:</label>
                    <input type="text" id="coMan" placeholder="Enter Co. Man">
                </div>
            </div>
        </div>

        <div class="container mt-5">
            <table id="billingTable">
                <thead>
                    <tr>
                        <th colspan="4">BILLING</th>
                    </tr>
                    <tr>
                        <th>SERVICES</th>
                        <th>UNITS</th>
                        <th>UNIT PRICE</th>
                        <th>TOTAL</th>
                    </tr>
                </thead>
                <tbody>
                    ${[
                        { service: "Rig", price: 340 },
                        { service: "Extra Labor", price: 145 },
                        { service: "Rig Supervisor", price: 500 },
                        { service: "Travel Time", price: 300 },
                        { service: "Out of Town", price: 180 },
                        { service: "Crew Truck", price: 150 },
                        { service: "Rig Standby", price: 350 },
                        { service: "Safety", price: 50 },
                    ].map(
                        (item) => `
                        <tr>
                            <td>${item.service}</td>
                            <td><input type="number" class="units" data-price="${item.price}" onchange="updateTotal()"></td>
                            <td>$${item.price.toFixed(2)}</td>
                            <td class="total">$0.00</td>
                        </tr>`
                    ).join('')}
                </tbody>
            </table>
        </div>

        <div class="container mt-5">
            <table id="payrollTable">
                <thead>
                    <tr>
                        <th colspan="6">PAYROLL</th>
                    </tr>
                    <tr>
                        <th>JOB TITLE</th>
                        <th>NAME</th>
                        <th>TIME</th>
                        <th>TIME</th>
                        <th>TOTAL HOURS</th>
                        <th>SHIFT</th>
                    </tr>
                </thead>
                <tbody>
                    ${['Pusher', 'Operator', 'Derrickhand', 'Floorhand', 'Extra Worker'].map((role) =>
                        `<tr>
                            <td>${role}</td>
                            <td><textarea class="form-control" placeholder="Enter ${role}'s Name"></textarea></td>
                            <td><input type="time" class="start-time"></td>
                            <td><input type="time" class="end-time"></td>
                            <td class="total-hours">0</td>
                            <td><select class="shift"><option disabled selected>Select shift</option><option>Day</option><option>Night</option></select></td>
                        </tr>`).join('')}
                </tbody>
            </table>
        </div>

        <div class="container mt-3">
            <button id="generatePDF" class="btn btn-success">Download PDF</button>
            <button type="submit" class="btn btn-primary">Submit Form</button>
        </div>
    </form>

    <script>
        function updateTotal() {
            const unitInputs = document.querySelectorAll('.units');
            let grandTotal = 0;
            unitInputs.forEach(input => {
                const price = parseFloat(input.getAttribute('data-price')) || 0;
                const units = parseFloat(input.value) || 0;
                const total = price * units;
                input.closest('tr').querySelector('.total').textContent = `$${total.toFixed(2)}`;
                grandTotal += total;
            });
            document.getElementById('fieldTicketTotal').textContent = `$${grandTotal.toFixed(2)}`;
        }

        function calculateTotalHours() {
            document.querySelectorAll('#payrollTable tbody tr').forEach(row => {
                const startTime = row.querySelector('.start-time').value;
                const endTime = row.querySelector('.end-time').value;
                const totalHoursCell = row.querySelector('.total-hours');
                if (startTime && endTime) {
                    const start = new Date(`1970-01-01T${startTime}:00`);
                    const end = new Date(`1970-01-01T${endTime}:00`);
                    if (end <= start) end.setDate(end.getDate() + 1);
                    const hoursWorked = (end - start) / (1000 * 60 * 60);
                    totalHoursCell.textContent = hoursWorked > 0 ? hoursWorked.toFixed(2) : 0;
                } else {
                    totalHoursCell.textContent = 0;
                }
            });
        }

        function setupEventListeners() {
            document.querySelectorAll('.start-time, .end-time').forEach(input => {
                input.addEventListener('change', calculateTotalHours);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            updateTotal();
            calculateTotalHours();

            const generatePDF = document.getElementById('generatePDF');
            generatePDF.addEventListener('click', () => {
                const filename = `${document.getElementById('customer').value || 'Customer'}_${document.getElementById('ticket').value || 'Ticket'}_${document.getElementById('rig').value || 'Rig'}.pdf`;
                const element = document.getElementById('fieldTicketForm');
                const opt = {
                    margin: 0.5,
                    filename,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, scrollY: 0, useCORS: true, logging: true },
                    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
                };

                html2pdf().from(element).set(opt).save();
            });
        });
    </script>
</body>
</html>
